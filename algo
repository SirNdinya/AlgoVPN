#!/bin/bash

p12_export_password () {
  echo -n "
Enter the password for p12 certificates (default: vpn):
: "
  read -s P  
  P=${P:-vpn}
}

algo_provisioning () {
  echo -n "
  What provider would you like to use?
    1. DigitalOcean
    2. Amazon EC2
    3. Google Compute Engine
    4. Remote installation (install to existing Ubuntu server)

Enter the number of your desired provider  
: "

  read N

  case "$N" in
    1) CLOUD="digitalocean" ;;
    2) CLOUD="ec2" ;;
    3) CLOUD="gce" ;;
    4) CLOUD="non-cloud" ;;
    *) exit 1 ;;
  esac
  
  p12_export_password
  
  # Use a local connection for non-cloud installations
  case "${CLOUD}" in
    "non-cloud") ansible-playbook "${CLOUD}.yml" -e easyrsa_p12_export_password=${P} --connection=local ;;
    *) ansible-playbook "${CLOUD}.yml" -e easyrsa_p12_export_password=${P} ;;
  esac
}

user_management () {
  p12_export_password
  # Use a local connection for non-cloud installations
  echo -n "
  What provider would you like to use?
    1. Remote Server
    2. Local Server

: "

  read N

  case "$N" in
    2) ansible-playbook users.yml -e easyrsa_p12_export_password=${P}  --connection=local ;;
    *) ansible-playbook users.yml -e easyrsa_p12_export_password=${P} ;;
  esac
}

case "$1" in
  update-users)  user_management   ;;
  *)      algo_provisioning ;;
esac 
